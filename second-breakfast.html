<!DOCTYPE html>
<!-- ¬© 2026 Second Breakfast. Built by Rob Voyzey. All rights reserved. Not for redistribution. -->
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22Second%20Breakfast%22%2C%22short_name%22%3A%222nd%20Breakfast%22%2C%22description%22%3A%22A%20proper%20account%20of%20a%20proper%20adventure%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23EBE2CE%22%2C%22theme_color%22%3A%22%233A6418%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20192%20192'%3E%3Crect%20width%3D'192'%20height%3D'192'%20rx%3D'40'%20fill%3D'%2523EBE2CE'%2F%3E%3Crect%20width%3D'192'%20height%3D'192'%20rx%3D'40'%20fill%3D'%25233A6418'%20opacity%3D'.12'%2F%3E%3Ctext%20x%3D'50%2525'%20y%3D'52%2525'%20dominant-baseline%3D'middle'%20text-anchor%3D'middle'%20font-family%3D'Georgia%2Cserif'%20font-weight%3D'900'%20font-size%3D'88'%20fill%3D'%25233A6418'%3ESB%3C%2Ftext%3E%3Ccircle%20cx%3D'142'%20cy%3D'142'%20r%3D'18'%20fill%3D'%2523A05C1C'%2F%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' rx='40' fill='%23EBE2CE'/><rect width='192' height='192' rx='40' fill='%233A6418' opacity='.12'/><text x='50%25' y='52%25' dominant-baseline='middle' text-anchor='middle' font-family='Georgia,serif' font-weight='900' font-size='88' fill='%233A6418'>SB</text><circle cx='142' cy='142' r='18' fill='%23A05C1C'/></svg>">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="2nd Breakfast">
<meta name="theme-color" content="#3A6418">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Second Breakfast">
<title>Second Breakfast</title>
<style>:root{--bg:#F4EDE0;--bg2:#EBE2CE;--bg3:#DFD5BF;--surf:#CFC5AF;--bord:#B8A88E;--bord2:#9C8C72;--pri:#3A6418;--pri2:#4A7C22;--acc:#A05C1C;--acc2:#B87030;--ink:#18120A;--ink2:#52380E;--ink3:#806040;--ok:#2A5A28;--okbg:#DCF0DA;--err:#8C1C10;--errbg:#F5DDD8;--warn:#8C520A;--warnbg:#F5EAD0;--r:14px;--rs:10px}[data-theme="dark"]{--bg:#0A1208;--bg2:#101A0C;--bg3:#162212;--surf:#1E2E18;--bord:#2A3E22;--bord2:#384E2E;--pri:#5A8C2E;--pri2:#6AA03A;--acc:#C07830;--acc2:#D89044;--ink:#E8E0D0;--ink2:#8AAC6A;--ink3:#587040;--ok:#3AAC48;--okbg:#081808;--err:#D04040;--errbg:#180808;--warn:#C09030;--warnbg:#181400}*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}html{height:100%}body{font-family:-apple-system,'Segoe UI',Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);font-size:16px;-webkit-font-smoothing:antialiased;min-height:100dvh}.scr{display:none;min-height:100dvh;flex-direction:column}.scr.on{display:flex}#ob{background:radial-gradient(ellipse 100% 45% at 50% 0%,var(--okbg) 0%,var(--bg) 70%);align-items:center;padding:44px 20px 52px;overflow-y:auto}.ob-logo{font-family:Georgia,serif;font-size:2.8rem;font-weight:800;color:var(--pri);letter-spacing:-.02em;margin-bottom:4px;text-align:center}.ob-logo em{color:var(--acc);font-style:normal;font-weight:400}.ob-tag{font-size:.7rem;letter-spacing:.18em;text-transform:uppercase;color:var(--ink3);margin-bottom:32px;text-align:center}.ob-card{width:100%;max-width:440px;background:var(--bg2);border:1px solid var(--bord);border-radius:20px;padding:22px 18px 26px;box-shadow:0 4px 20px rgba(0,0,0,.1)}.ob-card h2{font-family:Georgia,serif;font-size:1.15rem;color:var(--pri);margin-bottom:4px}.ob-card p{font-size:.82rem;color:var(--ink2);line-height:1.6;margin-bottom:14px}.fl{display:block;font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3);margin-bottom:5px;margin-top:12px}.fi{width:100%;background:var(--bg3);border:1.5px solid var(--bord);border-radius:var(--rs);padding:12px 13px;font-family:inherit;font-size:1rem;color:var(--ink);outline:none;transition:border-color .2s;-webkit-appearance:none;appearance:none}.fi:focus{border-color:var(--pri)}.fi::placeholder{color:var(--ink3)}.fi2{display:grid;grid-template-columns:1fr 1fr;gap:10px}.btn{display:flex;align-items:center;justify-content:center;width:100%;padding:14px;border:none;border-radius:var(--rs);font-family:inherit;font-size:1rem;font-weight:700;cursor:pointer;transition:all .18s;margin-top:10px}.btn-p{background:var(--pri);color:#fff}.btn-p:active{opacity:.85;transform:scale(.98)}.btn-g{background:var(--surf);color:var(--ink2);border:1px solid var(--bord)}.btn-g:active{opacity:.8}.btn-d{background:var(--errbg);color:var(--err);border:1px solid var(--err)}#app{background:var(--bg);height:100dvh;display:none;flex-direction:column;overflow:hidden}#app.on{display:flex}.hdr{flex-shrink:0;display:flex;align-items:center;justify-content:space-between;padding:12px 14px 10px;background:var(--bg2);border-bottom:1px solid var(--bord);z-index:10;gap:8px}.hdr-logo{font-family:Georgia,serif;font-size:1.2rem;font-weight:800;color:var(--pri)}.hdr-logo em{color:var(--acc);font-style:normal;font-weight:400}.hdr-r{display:flex;align-items:center;gap:6px}.ttog{background:none;border:1px solid var(--bord);border-radius:20px;cursor:pointer;padding:5px 9px;color:var(--ink2);font-size:.85rem}.prof-pill{display:flex;align-items:center;background:var(--surf);border:1px solid var(--bord);border-radius:20px;padding:5px 11px;font-size:.76rem;color:var(--ink2);cursor:pointer;white-space:nowrap}.prof-pill:active{opacity:.8}.body{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain;padding:12px 13px calc(68px+env(safe-area-inset-bottom,0px))}.nav{flex-shrink:0;display:flex;background:var(--bg2);border-top:1px solid var(--bord);padding-bottom:env(safe-area-inset-bottom,0px);z-index:10}.nb{flex:1;display:flex;flex-direction:column;align-items:center;padding:9px 4px 7px;gap:3px;background:none;border:none;color:var(--ink3);font-family:inherit;font-size:.56rem;font-weight:700;text-transform:uppercase;cursor:pointer;transition:color .2s}.nb.on{color:var(--pri)}.nb svg{width:21px;height:21px;stroke-width:1.7}.view{display:none}.view.on{display:block}.card{background:var(--bg2);border:1px solid var(--bord);border-radius:var(--r);padding:14px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,.05)}.card-title{font-family:Georgia,serif;font-size:.76rem;font-weight:700;letter-spacing:.05em;color:var(--acc);margin-bottom:12px}.bwk{font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3);margin-bottom:4px}.brow{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px}.bamt{font-family:Georgia,serif;font-size:1.9rem;font-weight:700;letter-spacing:-.02em;color:var(--ink);line-height:1}.bof{font-size:.78rem;color:var(--ink2);margin-bottom:3px}.bpill{font-size:.72rem;font-weight:700;padding:4px 10px;border-radius:20px}.bp-ok{background:var(--okbg);color:var(--ok)}.bp-warn{background:var(--warnbg);color:var(--warn)}.bp-over{background:var(--errbg);color:var(--err)}.bbar{height:5px;background:var(--surf);border-radius:99px;overflow:hidden}.bfill{height:100%;border-radius:99px;transition:width .7s cubic-bezier(.34,1.4,.64,1)}.bf-ok{background:var(--ok)}.bf-warn{background:var(--warn)}.bf-over{background:var(--err)}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:10px}.stat{background:var(--bg2);border:1px solid var(--bord);border-radius:var(--rs);padding:10px 7px;text-align:center}.sv{font-family:Georgia,serif;font-size:.92rem;font-weight:700;color:var(--ink);margin-bottom:2px}.sv-ok{color:var(--ok)}.sv-warn{color:var(--warn)}.sv-over{color:var(--err)}.sl-pair{display:flex;flex-direction:column;gap:1px}.sl-budget{font-size:.48rem;color:var(--ink3);font-weight:500;letter-spacing:.04em}.sl{font-size:.56rem;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(--ink3)}.qe{background:var(--bg2);border:1px solid var(--bord);border-radius:var(--r);padding:13px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,.05)}.qlbl{font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3);margin-bottom:7px}.qrow{display:flex;gap:8px}.qi{flex:1;min-width:0;background:var(--bg3);border:1.5px solid var(--bord);border-radius:var(--rs);padding:13px;font-family:inherit;font-size:1rem;color:var(--ink);outline:none;transition:border-color .2s;-webkit-appearance:none}.qi:focus{border-color:var(--pri)}.qi::placeholder{color:var(--ink3)}.qbtn{width:48px;height:48px;flex-shrink:0;background:var(--pri);border:none;border-radius:var(--rs);display:flex;align-items:center;justify-content:center;cursor:pointer;color:#fff}.qbtn:active{opacity:.85;transform:scale(.95)}.qbtn svg{width:20px;height:20px;stroke-width:2.2}.qhint{font-size:.68rem;color:var(--ink3);margin-top:7px;line-height:1.5}.cc{background:var(--bg2);border:1.5px solid var(--pri);border-radius:var(--r);padding:14px;margin-bottom:10px;display:none;box-shadow:0 2px 12px rgba(58,100,24,.15)}.cc.on{display:block}.cchdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.cctitle{font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--pri)}.chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}.chip{padding:6px 11px;border-radius:20px;border:1.5px solid var(--bord);font-size:.76rem;cursor:pointer;color:var(--ink2);background:var(--bg3);white-space:nowrap;font-family:inherit;transition:all .15s}.chip.on{background:var(--pri);border-color:var(--pri);color:#fff;font-weight:700}.fg{display:flex;flex-direction:column;gap:4px;margin-bottom:10px}.fgl{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.09em;color:var(--ink3)}.fgv{background:var(--bg3);border:1.5px solid var(--bord);border-radius:8px;padding:11px 12px;font-family:inherit;font-size:.95rem;color:var(--ink);outline:none;transition:border-color .2s;-webkit-appearance:none;appearance:none;width:100%}.fgv:focus{border-color:var(--pri)}.fgv::placeholder{color:var(--ink3)}.fgconv{background:var(--bg3);border:1.5px solid var(--bord);border-radius:8px;padding:11px 12px;font-family:Georgia,serif;font-size:.95rem;color:var(--ok);font-weight:700}.fg2{display:grid;grid-template-columns:1fr 1fr;gap:10px}.nrow{display:none;margin-bottom:10px}.nrow.on{display:block}.nsub{font-size:.7rem;color:var(--ink3);margin-top:5px}.nsub b{color:var(--pri)}.splitbtn{background:none;border:1px dashed var(--bord);border-radius:8px;padding:8px 12px;font-size:.76rem;color:var(--ink3);cursor:pointer;font-family:inherit;width:100%;margin-bottom:10px;display:none;text-align:center}.srow{display:flex;gap:8px;margin-top:4px}.bsave{flex:1;padding:13px;background:var(--pri);color:#fff;border:none;border-radius:var(--rs);font-family:inherit;font-size:1rem;font-weight:700;cursor:pointer}.bsave:active{opacity:.85;transform:scale(.98)}.bclr{padding:13px 15px;background:var(--surf);color:var(--ink2);border:1px solid var(--bord);border-radius:var(--rs);font-family:inherit;cursor:pointer}.efeed{display:flex;flex-direction:column;gap:6px}.erow{display:grid;grid-template-columns:42px 1fr auto;gap:10px;align-items:center;background:var(--bg2);border:1px solid var(--bord);border-radius:var(--rs);padding:11px 12px;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.05)}.erow:active{border-color:var(--bord2)}.eico{width:42px;height:42px;border-radius:11px;background:var(--surf);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}.ecat{font-weight:700;font-size:.86rem;color:var(--ink);margin-bottom:2px}.emeta{font-size:.68rem;color:var(--ink3)}.eamts{text-align:right}.einr{font-weight:700;font-size:.88rem;color:var(--ink)}.eaud{font-size:.68rem;color:var(--ink2);margin-top:1px}.epn{font-size:.63rem;color:var(--ink3);margin-top:1px}.legdiv{display:flex;align-items:center;gap:8px;margin:10px 0 6px;font-size:.64rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3)}.legdiv::before,.legdiv::after{content:"";flex:1;height:1px;background:var(--bord)}.legdiv span{white-space:nowrap;background:var(--bg3);border:1px solid var(--bord);border-radius:20px;padding:3px 10px;color:var(--ink2)}.datehdr{display:flex;justify-content:space-between;align-items:center;padding:10px 2px 5px;margin-top:4px}.datehdr:first-child{margin-top:0}.dh-d{font-family:Georgia,serif;font-size:.82rem;font-weight:700;color:var(--ink2)}.dh-a{font-size:.76rem;font-weight:700;color:var(--ink3)}.shdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.slbl{font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3)}.slink{font-size:.74rem;color:var(--pri);background:none;border:none;font-family:inherit;cursor:pointer;padding:0}.empty{text-align:center;padding:36px 16px;color:var(--ink3)}.empty-ico{font-size:2rem;margin-bottom:10px;opacity:.5}.empty p{font-size:.82rem;line-height:1.7}.lsearch{background:var(--bg2);border:1.5px solid var(--bord);border-radius:var(--rs);padding:11px 13px;font-family:inherit;font-size:.95rem;color:var(--ink);outline:none;width:100%;margin-bottom:9px;transition:border-color .2s}.lsearch:focus{border-color:var(--pri)}.lsearch::placeholder{color:var(--ink3)}.frow2{display:flex;gap:6px;overflow-x:auto;padding-bottom:3px;margin-bottom:8px;scrollbar-width:none}.frow2::-webkit-scrollbar{display:none}.fchip{padding:6px 13px;border-radius:20px;border:1.5px solid var(--bord);font-size:.74rem;font-weight:600;white-space:nowrap;cursor:pointer;color:var(--ink2);background:var(--bg2);flex-shrink:0;font-family:inherit;transition:all .15s}.fchip.on{background:var(--pri);border-color:var(--pri);color:#fff}.vtog{display:flex;gap:6px;margin-bottom:10px}.vtb{flex:1;padding:8px;background:var(--surf);border:1.5px solid var(--bord);border-radius:8px;font-family:inherit;font-size:.76rem;font-weight:700;color:var(--ink2);cursor:pointer;text-align:center;transition:all .15s}.vtb.on{background:var(--bg2);border-color:var(--pri);color:var(--pri)}.dcwrap{overflow-x:auto;scrollbar-width:none;padding-bottom:4px}.dcwrap::-webkit-scrollbar{display:none}.dchart{display:flex;align-items:flex-end;gap:3px;height:70px}.dbc{display:flex;flex-direction:column;align-items:center;flex-shrink:0;width:30px;cursor:pointer}.dbb{width:20px;border-radius:4px 4px 0 0;min-height:2px;transition:height .4s ease}.dbb.ok{background:var(--ok)}.dbb.warn{background:var(--warn)}.dbb.over{background:var(--err)}.dbb.zero{background:var(--surf);border-radius:4px}.dbl{font-size:.5rem;color:var(--ink3);margin-top:4px;text-align:center;line-height:1.3}.dbc.tod .dbl{color:var(--pri);font-weight:700}.dcsub{font-size:.7rem;color:var(--ink3);margin-top:8px}.rrow{display:grid;grid-template-columns:38px 1fr 68px;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid var(--bord)}.rrow:last-child{border-bottom:none}.rico{font-size:1.05rem;text-align:center}.rname{font-size:.84rem;font-weight:700;color:var(--ink);margin-bottom:4px}.rbar{height:3px;background:var(--surf);border-radius:99px;overflow:hidden}.rfill{height:100%;border-radius:99px;transition:width .5s ease}.rsub{font-size:.63rem;color:var(--ink3);margin-top:3px}.ramt{font-family:Georgia,serif;font-size:.84rem;font-weight:700;color:var(--ink);text-align:right}.wrow{display:grid;grid-template-columns:72px 1fr 60px 52px;gap:6px;align-items:center;padding:10px 0;border-bottom:1px solid var(--bord)}.wrow:last-child{border-bottom:none}.wlbl{font-size:.8rem;font-weight:700;color:var(--ink)}.wdates{font-size:.62rem;color:var(--ink3);margin-top:2px}.wbar{height:3px;background:var(--surf);border-radius:99px;overflow:hidden;margin-top:5px}.wbf{height:100%;border-radius:99px;background:var(--pri)}.wamt{font-family:Georgia,serif;font-size:.8rem;font-weight:700;color:var(--ink);text-align:right}.wvs{font-size:.65rem;font-weight:700;text-align:right}.wok{color:var(--ok)}.wover{color:var(--err)}.crow{display:grid;grid-template-columns:34px 1fr 68px;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid var(--bord)}.crow:last-child{border-bottom:none}.cflag{font-size:1.35rem;text-align:center}.cname{font-size:.84rem;font-weight:700;color:var(--ink);margin-bottom:4px}.csub{font-size:.63rem;color:var(--ink3);margin-top:3px}.ss{background:var(--bg2);border:1px solid var(--bord);border-radius:var(--r);overflow:hidden;margin-bottom:10px;box-shadow:0 1px 4px rgba(0,0,0,.05)}.ssl{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--ink3);padding:10px 14px 5px}.sr{display:flex;align-items:center;justify-content:space-between;padding:13px 14px;border-bottom:1px solid var(--bord);cursor:pointer;transition:background .15s}.sr:last-child{border-bottom:none}.sr:active{background:var(--bg3)}.srn{font-size:.88rem;font-weight:600;color:var(--ink)}.srv{font-size:.78rem;color:var(--ink2)}.ovl{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:200;align-items:flex-end;justify-content:center}.ovl.on{display:flex}.sheet{background:var(--bg2);border-top:1px solid var(--bord);border-radius:22px 22px 0 0;padding:16px 16px calc(24px+env(safe-area-inset-bottom,0px));width:100%;max-width:480px;max-height:90dvh;overflow-y:auto;-webkit-overflow-scrolling:touch;box-shadow:0 -4px 24px rgba(0,0,0,.12)}.handle{width:32px;height:4px;background:var(--bord2);border-radius:99px;margin:0 auto 16px}.stitle{font-family:Georgia,serif;font-size:1.15rem;font-weight:700;margin-bottom:4px;color:var(--ink)}.ssub{font-size:.8rem;color:var(--ink2);margin-bottom:16px;line-height:1.5}.egrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}.efull{grid-column:1/-1}.toast{position:fixed;bottom:calc(72px+env(safe-area-inset-bottom,0px));left:50%;transform:translateX(-50%) translateY(12px);background:var(--ink);color:var(--bg);padding:9px 18px;border-radius:30px;font-size:.84rem;font-weight:700;z-index:400;opacity:0;pointer-events:none;white-space:nowrap;transition:all .28s cubic-bezier(.34,1.4,.64,1)}.toast.on{opacity:1;transform:translateX(-50%) translateY(0)}.warn-box{background:var(--warnbg);border:1px solid var(--warn);border-radius:var(--rs);padding:10px 12px;font-size:.76rem;color:var(--ink2);line-height:1.6;margin-bottom:10px}.warn-box b{color:var(--warn)}.cc-pick{display:flex;align-items:center;gap:8px;background:var(--okbg);border:2px solid var(--pri);border-radius:8px;padding:10px 14px;font-size:.95rem;font-weight:700;color:var(--pri);cursor:pointer;font-family:Georgia,serif}.cc-pick strong{flex:1}.cc-pick-hint{font-size:.6rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--ink3);text-decoration:underline;font-family:var(--sans)}.slink-row{text-align:center;padding:6px 0 2px}.export-nudge{display:none;align-items:center;gap:10px;background:var(--surf);border:1px solid var(--bord);border-radius:8px;padding:10px 14px;margin-bottom:12px;font-size:.76rem}.export-nudge-ico{font-size:1.1rem;flex-shrink:0}.export-nudge-txt{flex:1;color:var(--ink2);line-height:1.5}.export-nudge-txt b{color:var(--ink);display:block;margin-bottom:2px}.export-nudge-btn{background:var(--pri);color:#fff;border:none;border-radius:6px;padding:6px 12px;font-size:.68rem;font-weight:700;cursor:pointer;white-space:nowrap}.export-nudge-x{background:none;border:none;color:var(--ink3);cursor:pointer;font-size:1rem;padding:0 4px;flex-shrink:0}</style>
</head>
<body>
<div class="scr on" id="ob"><div class="ob-logo">Second Breakfast<em>.</em></div><div class="ob-tag">a proper account of a proper adventure</div><div class="ob-card"><h2>The purse a halfling trusts on every adventure.</h2><p>30 seconds to set up. Your coins stay on this device only. No servers, no cloud, no Sauron.</p><label class="fl">Your name</label><input class="fi" id="ob-name" placeholder="Bilbo Baggins" autocomplete="given-name"><div class="fi2"><div><label class="fl">Trip start</label><input class="fi" id="ob-start" type="date"></div><div><label class="fl">Weekly budget</label><input class="fi" id="ob-budget" type="number" value="1000" min="1" inputmode="decimal"></div></div><label class="fl">Home currency (e.g. AUD, GBP, EUR)</label><input class="fi" id="ob-home" value="AUD" maxlength="3" autocomplete="off" style="text-transform:uppercase"><div class="fi2"><div><label class="fl">Starting country</label><input class="fi" id="ob-country" value="India"></div><div><label class="fl">Local currency</label><input class="fi" id="ob-local" value="INR" maxlength="3" autocomplete="off" style="text-transform:uppercase"></div></div><label class="fl">Exchange rate (1 AUD = how many local?)</label><input class="fi" id="ob-rate" type="number" value="64.14" step="0.01" inputmode="decimal"><button class="btn btn-p" onclick="finishSetup()" style="margin-top:18px;padding:16px;font-size:1rem">I&#8217;m going on an adventure! &#8594;</button></div>
</div><div id="app"><div class="hdr"><div class="hdr-logo">Second Breakfast<em>.</em></div><div class="hdr-r"><button class="ttog" onclick="toggleTheme()" id="ttog">&#127769;</button><div class="prof-pill" onclick="openProfileModal()" id="hdr-pill">&#127470;&#127475; INR</div></div></div><div class="body"><div class="view on" id="v-add"><div class="card" id="budget-card"></div><div class="stats" id="stats-row"></div><div class="qe"><div class="qlbl">What did you spend on?</div><div class="qrow"><input class="qi" id="qinput" placeholder="chai 50  &middot;  hotel 4500 3 nights  &middot;  taxi 350" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" onkeydown="if(event.key==='Enter'){parseIt()}"><button class="qbtn" onclick="parseIt()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button></div><div class="qhint">Write it how you&#8217;d say it. We sort the rest.</div></div><div class="cc" id="cc"><div class="cchdr"><span class="cctitle">Confirm this expense</span></div><div id="cc-pick-wrap" style="margin-bottom:8px"></div><div id="cc-chips-wrap" style="display:none"><div class="chips" id="cc-chips"></div></div><div class="fg2" style="margin-bottom:10px"><div class="fg"><div class="fgl">Amount (<span id="cc-sym">&#8377;</span>)</div><input class="fgv" type="number" id="cc-inr" inputmode="decimal" oninput="recalc()"></div><div class="fg"><div class="fgl">&#8776; <span id="cc-hclbl">AUD</span></div><div class="fgconv" id="cc-aud">&mdash;</div></div></div><div class="fg2" style="margin-bottom:10px"><div class="fg"><div class="fgl">Date <button onclick="setYesterday()" style="background:none;border:none;font-size:.58rem;color:var(--pri);cursor:pointer;font-family:inherit;padding:0;margin-left:6px;font-weight:700;text-transform:uppercase;letter-spacing:.06em">‚Üê yesterday</button></div><input class="fgv" type="date" id="cc-date"></div><div class="fg"><div class="fgl">Location</div><input class="fgv" type="text" id="cc-loc" placeholder="optional" autocomplete="off" autocorrect="off" oninput="this.style.color='var(--ink)';this.setAttribute('data-prefilled','0')"></div></div><button class="splitbtn" id="splitbtn" onclick="showSplit()">+ Split across days</button><div class="nrow" id="cc-nrow"><div class="fgl" style="margin-bottom:5px" id="cc-dlbl">Days / Nights</div><input class="fgv" type="number" id="cc-days" inputmode="numeric" min="1" placeholder="e.g. 3" oninput="recalc()"><div class="nsub">Per unit: <b id="cc-pn">&mdash;</b></div></div><div class="fg" style="margin-bottom:12px"><div class="fgl">Note (optional)</div><input class="fgv" type="text" id="cc-note" placeholder="any extra detail..." autocomplete="off"></div><div class="srow"><button class="bclr" onclick="clearCC()">Clear</button><button class="bsave" onclick="saveExp()">Add to Purse</button></div></div><div><div class="shdr"><span class="slbl">Recent</span><button class="slink" onclick="goView('log')">See all &#8594;</button></div><div class="efeed" id="recent"></div></div></div><div class="view" id="v-log" ><div class="export-nudge" id="export-nudge"><span class="export-nudge-ico">üì¶</span><div class="export-nudge-txt"><b>Worth backing up.</b>Export your trail ‚Äî it's the only copy.</div><button class="export-nudge-btn" onclick="doExport()">Export CSV</button><button class="export-nudge-x" onclick="dismissNudge()">‚úï</button></div><input class="lsearch" id="lsearch" placeholder="&#128269; Search expenses..." oninput="renderLog()"><div class="frow2" id="frow2"></div><div class="vtog"><button class="vtb on" id="vtb-date" onclick="setLV('date')">&#128197; By Date</button><button class="vtb" id="vtb-country" onclick="setLV('country')">&#128205; By Country</button></div><div class="efeed" id="logfeed"></div></div><div class="view" id="v-reports"><div class="card"><div class="card-title">Daily Spend</div><div class="dcwrap"><div class="dchart" id="dchart"></div></div><div class="dcsub" id="dcsub"></div></div><div class="card"><div class="card-title">Weekly vs Budget</div><div id="r-weekly"></div></div><div class="card"><div class="card-title">By Country / Leg</div><div id="r-country"></div></div><div class="card"><div class="card-title">By Category</div><div id="r-cat"></div></div><div class="card"><div class="card-title">By Location</div><div id="r-loc"></div></div></div><div class="view" id="v-settings"><div class="ssl">Trip Profile</div><div class="ss"><div class="sr" onclick="openProfileModal()"><span class="srn">Country &amp; Currency</span><span class="srv" id="s-country">&mdash;</span></div><div class="sr" onclick="openRateModal()"><span class="srn">Exchange Rate</span><span class="srv" id="s-rate">&mdash;</span></div><div class="sr" onclick="openBudgetModal()"><span class="srn">Weekly Budget</span><span class="srv" id="s-budget">&mdash;</span></div><div class="sr" onclick="openStartModal()"><span class="srn">Trip Start Date</span><span class="srv" id="s-start">&mdash;</span></div></div><div class="ssl">Categories</div><div class="ss"><div class="sr" onclick="openCustomCatModal()"><span class="srn">Custom Categories</span><span class="srv" id="s-cc">None</span></div></div><div class="ssl">Backup &amp; Restore</div><div class="warn-box"><b>&#9888; Keep your data safe:</b> Export weekly. If you open a <em>new copy</em> of this file, it starts empty &mdash; always use the same saved bookmark or home screen icon.<br><br><b>Import adds new expenses</b> &mdash; it won&#8217;t duplicate ones already here. It does not delete existing data.</div><div class="ss"><div class="sr" onclick="doExport()"><span class="srn">Export CSV (open in Excel)</span><span class="srv">&#8595; Save</span></div><div class="sr" onclick="doJsonBackup()"><span class="srn">Backup code (mobile friendly)</span><span class="srv">&#128274; Safe</span></div><div class="sr" onclick="doImport()"><span class="srn">Import CSV (restore backup)</span><span class="srv">&#8593; Load</span></div></div><div class="ssl">About</div><div style="padding:10px 14px 4px;font-size:.6rem;color:var(--ink3);letter-spacing:.06em;">¬© 2026 Second Breakfast ¬∑ Built by Rob Voyzey</div><div class="ss"><div class="sr"><span class="srn">Traveller</span><span class="srv" id="s-name">&mdash;</span></div><div class="sr" onclick="toggleTheme()"><span class="srn">Light / Dark mode</span><span class="srv" id="s-theme">Light</span></div><div class="sr" onclick="openShareModal()"><span class="srn">Share with a fellow hobbit</span><span class="srv">&#8599;</span></div><div class="sr" onclick="clearExpenses()"><span class="srn" style="color:var(--err)">Clear all expenses</span><span class="srv">Keeps your profile</span></div><div class="sr" onclick="newTrip()"><span class="srn" style="color:var(--err)">Start a new trip</span><span class="srv">Full reset</span></div></div></div></div><nav class="nav"><button class="nb on" id="nb-add" onclick="goView('add')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>Add</button><button class="nb" id="nb-log" onclick="goView('log')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>Ledger</button><button class="nb" id="nb-reports" onclick="goView('reports')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>Trail</button><button class="nb" id="nb-settings" onclick="goView('settings')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>Settings</button></nav>
</div><div class="ovl" id="m-exp"><div class="sheet"><div class="handle"></div><div id="me-detail"><div class="stitle" id="me-title">Expense</div><div id="me-body" style="margin-bottom:14px"></div><div style="display:flex;gap:8px"><button class="btn btn-g" style="flex:1;margin-top:0;padding:12px" onclick="switchMode('edit')">&#9999; Edit</button><button class="btn btn-d" style="flex:1;margin-top:0;padding:12px" onclick="doDelete()">&#128465; Delete</button></div><button class="btn btn-g" style="color:var(--ink3)" onclick="closeModal('m-exp')">Close</button></div><div id="me-edit" style="display:none"><div class="stitle">Edit Expense</div><div class="chips" id="e-chips" style="margin-bottom:12px"></div><div class="egrid"><div class="fg"><div class="fgl">Amount</div><input class="fgv" type="number" id="e-inr" inputmode="decimal" oninput="recalcEdit()"></div><div class="fg"><div class="fgl">&#8776; <span id="e-hclbl">AUD</span></div><div class="fgconv" id="e-aud">&mdash;</div></div><div class="fg"><div class="fgl">Date</div><input class="fgv" type="date" id="e-date"></div><div class="fg"><div class="fgl">Location</div><input class="fgv" type="text" id="e-loc" placeholder="optional" autocomplete="off"></div><div class="fg efull" id="e-nrow" style="display:none"><div class="fgl" id="e-dlbl">Days / Nights</div><input class="fgv" type="number" id="e-days" inputmode="numeric" min="1" oninput="recalcEdit()"></div><div class="fg efull"><div class="fgl">Note</div><input class="fgv" type="text" id="e-note" placeholder="optional" autocomplete="off"></div></div><div style="display:flex;gap:8px;margin-top:4px"><button class="bclr" onclick="switchMode('detail')">Cancel</button><button class="bsave" onclick="saveEdit()">Save Changes</button></div></div>
</div></div><div class="ovl" id="m-profile"><div class="sheet"><div class="handle"></div><div class="stitle">Change Country</div><div class="ssub">Update when you cross a border. Old expenses keep their original rate forever.</div><label class="fl">Country</label><input class="fi" id="p-country" placeholder="India" oninput="autoFlag()"><div class="fi2"><div><label class="fl">Local currency</label><input class="fi" id="p-local" placeholder="INR" maxlength="3" autocomplete="off" style="text-transform:uppercase" oninput="autoSym()"></div><div><label class="fl">Symbol</label><input class="fi" id="p-sym" placeholder="&#8377;" maxlength="3"></div></div><div class="fi2"><div><label class="fl">Flag emoji</label><input class="fi" id="p-flag" placeholder="&#127470;&#127475;" maxlength="4"></div><div><label class="fl">1 <span id="p-hclbl">AUD</span> = ?</label><input class="fi" id="p-rate" type="number" step=".01" inputmode="decimal"></div></div><button class="btn btn-p" onclick="saveProfile()">Save &amp; Continue</button><button class="btn btn-g" onclick="closeModal('m-profile')">Cancel</button>
</div></div><div class="ovl" id="m-rate"><div class="sheet"><div class="handle"></div><div class="stitle">Update Exchange Rate</div><div class="ssub" id="rate-sub"></div><label class="fl">New rate</label><input class="fi" id="r-rate" type="number" step=".01" inputmode="decimal"><button class="btn btn-p" onclick="saveRate()">Update</button><button class="btn btn-g" onclick="closeModal('m-rate')">Cancel</button>
</div></div><div class="ovl" id="m-budget"><div class="sheet"><div class="handle"></div><div class="stitle">Weekly Budget</div><label class="fl">Amount in <span id="b-hclbl">AUD</span></label><input class="fi" id="b-val" type="number" step="50" min="1" inputmode="decimal"><button class="btn btn-p" onclick="saveBudget()">Save</button><button class="btn btn-g" onclick="closeModal('m-budget')">Cancel</button>
</div></div><div class="ovl" id="m-start"><div class="sheet"><div class="handle"></div><div class="stitle">Trip Start Date</div><label class="fl">Start date</label><input class="fi" id="ts-date" type="date"><button class="btn btn-p" onclick="saveStart()">Save</button><button class="btn btn-g" onclick="closeModal('m-start')">Cancel</button>
</div></div><div class="ovl" id="m-customcat"><div class="sheet"><div class="handle"></div><div class="stitle">Custom Categories</div><div class="ssub">Add your own alongside the 8 defaults.</div><div id="ccat-list"></div><div class="fi2" style="margin-top:14px"><input class="fi" id="ccat-e" placeholder="&#127946;" maxlength="8" style="text-align:center;font-size:1.3rem"><input class="fi" id="ccat-n" placeholder="Fitness, Laundry..."></div><button class="btn btn-p" onclick="addCustomCat()">Add Category</button><button class="btn btn-g" onclick="closeModal('m-customcat')">Done</button>
</div></div><div class="ovl" id="m-share"><div class="sheet"><div class="handle"></div><div class="stitle">Share with a fellow hobbit</div><div class="ssub">Send them <b>purse.html</b>. Their data stays on their device, completely separate from yours.</div><div style="background:var(--bg3);border:1px solid var(--bord);border-radius:var(--rs);padding:13px;font-size:.8rem;color:var(--ink2);line-height:1.9;margin-bottom:12px"><b style="color:var(--pri)">Android:</b> Open in Chrome &#8594; &#8942; &#8594; Add to Home Screen<br><b style="color:var(--pri)">iPhone:</b> Open in Safari &#8594; Share &#8594; Add to Home Screen
  </div><button class="btn btn-p" onclick="closeModal('m-share')">Got it</button>
</div></div><input type="file" id="csv-input" accept=".csv" style="display:none" onchange="handleImport(event)"><div class="ovl" id="m-backup"><div class="sheet"><div class="handle"></div><div class="stitle">Backup Code</div><div class="ssub">Copy this entire code and save it somewhere safe ‚Äî Notes, email, anywhere. Paste it back in to restore.</div><textarea class="fgv" id="bk-text" rows="6" style="font-size:.65rem;font-family:monospace;resize:none;margin-bottom:12px" placeholder="Paste backup code here to restore..."></textarea><button class="btn btn-p" onclick="doJsonRestore()">Restore from code</button><button class="btn btn-g" onclick="closeModal('m-backup')">Done</button>
</div></div>
<div class="toast" id="toast"></div><script>
var SK='sb_v1';
var CATS=[
  {id:0,n:'Food & Drink',e:'\u{1F35B}',kw:[
    'food','eat','ate','meal','lunch','dinner','breakfast','brunch','supper','snack','buffet','set meal','tasting menu',
    'drink','drinks','coffee','tea','chai','juice','water','smoothie','shake','beer','wine','spirits','whisky','whiskey','rum','gin','vodka','cocktail','pub','bar','brewery','lassi','lemonade','kombucha',
    'restaurant','cafe','canteen','eatery','diner','bistro','hawker','food court','street food','takeaway','takeout','delivery','bakery',
    'biryani','thali','dosa','samosa','masala','curry','rice','roti','dal','pho','ramen','laksa','pad thai','noodle','noodles','dim sum','dumplings','gyoza','sushi','bento','katsu','tempura','satay','rendang','nasi','banh mi','spring roll','som tam','tom yum','congee',
    'burger','pizza','pasta','sandwich','wrap','salad','soup','steak','fish','chips','fries','pie','bread','eggs','egg','toast','croissant','bagel','waffle','pancake','omelette','porridge','oats','granola','quiche','risotto','gnocchi','tacos','taco','burrito','quesadilla','nachos','tapas','mezze','hummus','falafel','kebab','shawarma','gyros',
    'snack','sweet','chocolate','biscuit','cake','gelato','ice cream','sorbet','dessert','fruit','pastry','muffin','brownie','cookie','donut','churros','crepe',
    'platter','sharing','bowl','stir fry','roast','grilled','fried','steamed','vegan','vegetarian'
  ]},
  {id:1,n:'Transport',e:'\u{1F682}',kw:[
    'taxi','cab','uber','ola','grab','lyft','auto','rickshaw','tuk tuk','bajaj','ojek','songthaew','minivan','van','jeep','bus','minibus','coach','shuttle','transfer',
    'train','metro','subway','tube','tram','BTS','MRT','skytrain','rail','railway','sleeper','overnight train','express',
    'flight','fly','flew','plane','airport','airline','airfare','boarding',
    'boat','ferry','speedboat','longtail','longboat','catamaran','water taxi','slow boat',
    'bike','bicycle','motorbike','motorcycle','moto','scooter','vespa','cycling',
    'petrol','fuel','gas','toll','parking','ticket','fare','transport','transit',
    'hire','rental','rent','car hire','car rental','bike hire','scooter hire','vehicle'
  ]},
  {id:2,n:'Accommodation',e:'\u{1F3E8}',kw:[
    'hotel','hostel','guesthouse','guest house','airbnb','room','stay','lodge','resort','dorm','dormitory',
    'bed','night','nights','inn','cottage','camp','camping','glamping','accommodation','accomodation','accom',
    'riad','villa','apartment','apt','bnb','bungalow','treehouse','homestay','farmstay','retreat',
    'pod','capsule','beach hut','eco lodge','safari lodge','tent'
  ]},
  {id:3,n:'Activities',e:'\u{1F3AD}',kw:[
    'tour','museum','temple','fort','palace','monument','ruins','ancient','heritage','gallery','exhibition','church','cathedral','mosque','shrine','pagoda','wat',
    'beach','waterfall','viewpoint','cave','canyon','volcano','rice terrace','national park','nature reserve','jungle','lake','island','lagoon','reef','snorkel','snorkeling','diving','dive','scuba',
    'trek','trekking','hike','hiking','climb','climbing','bungee','zipline','zip line','paragliding','rafting','kayak','kayaking','paddleboard','surfing','surf','kitesurfing',
    'safari','elephant','wildlife','bird watching','whale watching','dolphin','monkey',
    'yoga','meditation','wellness','class','lesson','workshop','cooking class','cooking','language class',
    'show','concert','cinema','movie','theatre','theater','festival','night market','circus','muay thai','fire show',
    'entry','admission','guide','experience','activity','excursion','day trip','boat trip','island hopping','sunset cruise','sunset','cruise'
  ]},
  {id:4,n:'Shopping',e:'\u{1F6CD}',kw:[
    'clothes','clothing','shirt','tshirt','top','dress','skirt','shorts','trousers','pants','jeans','jacket','hoodie','jumper','swimwear','bikini','swimsuit','shoes','sandals','flip flops','trainers','boots','hat','cap','sunglass','sunglasses','glasses','scarf','gloves','socks','underwear',
    'bag','backpack','daypack','handbag','wallet','watch','earrings','bracelet','necklace','ring','jewellery','jewelry',
    'market','bazaar','souvenir','gift','spice','spices','fabric','silk','craft','art','painting','carving','pottery','ceramics','incense','ornament',
    'book','books','map','electronics','phone','charger','adaptor','adapter','cable','headphones','camera','memory card','battery',
    'toiletries','shampoo','conditioner','toothpaste','razor','deodorant','laundry','dry cleaning','tailoring','tailor',
    'shop','shopping','store','mall','bought','buy','purchase'
  ]},
  {id:5,n:'Health',e:'\u{1F48A}',kw:[
    'pharmacy','chemist','medicine','medication','prescription','doctor','hospital','clinic','nurse','dentist','physio','physiotherapy','optician','test','PCR','vaccine','vaccination','injection','blood test',
    'tablet','pill','capsule','antibiotic','paracetamol','ibuprofen','antihistamine','rehydration','electrolytes','vitamins','vitamin','supplement','probiotic',
    'sunscreen','sunblock','insect repellent','mosquito','deet','bandage','plaster','blister','cream','ointment','antiseptic','first aid',
    'massage','spa','treatment','facial','manicure','pedicure','sauna','acupuncture',
    'health','medical','injury','sick','ill','unwell','recovery'
  ]},
  {id:6,n:'Visa & Admin',e:'\u{1F4C4}',kw:[
    'visa','e-visa','evisa','permit','border','border crossing','extension','arrival card','departure tax','embassy','consulate',
    'atm','cash','bank','exchange','currency exchange','money exchange','western union','wise','revolut','transfer','withdrawal','commission',
    'sim','sim card','data','wifi','internet','roaming','insurance','travel insurance','admin','photo','photos','print','printing','passport','passport photo','photocopy','notary','translation',
    'fee','charge','surcharge','tax','card fee','booking fee'
  ]},
  {id:7,n:'Other',e:'\u{1F4B8}',kw:[]},
]
var RC=['#3A6418','#A05C1C','#2A5A28','#8C520A','#5A8C2E','#C07830','#4A7C22','#8C1C10'];
var CFLAGS={india:'\u{1F1EE}\u{1F1F3}',nepal:'\u{1F1F3}\u{1F1F5}','sri lanka':'\u{1F1F1}\u{1F1F0}',thailand:'\u{1F1F9}\u{1F1ED}',vietnam:'\u{1F1FB}\u{1F1F3}',indonesia:'\u{1F1EE}\u{1F1E9}',malaysia:'\u{1F1F2}\u{1F1FE}',cambodia:'\u{1F1F0}\u{1F1ED}',myanmar:'\u{1F1F2}\u{1F1F2}',laos:'\u{1F1F1}\u{1F1E6}',singapore:'\u{1F1F8}\u{1F1EC}',philippines:'\u{1F1F5}\u{1F1ED}',japan:'\u{1F1EF}\u{1F1F5}',australia:'\u{1F1E6}\u{1F1FA}','new zealand':'\u{1F1F3}\u{1F1FF}',spain:'\u{1F1EA}\u{1F1F8}',portugal:'\u{1F1F5}\u{1F1F9}',italy:'\u{1F1EE}\u{1F1F9}',france:'\u{1F1EB}\u{1F1F7}',germany:'\u{1F1E9}\u{1F1EA}',uk:'\u{1F1EC}\u{1F1E7}','united kingdom':'\u{1F1EC}\u{1F1E7}',usa:'\u{1F1FA}\u{1F1F8}','united states':'\u{1F1FA}\u{1F1F8}',mexico:'\u{1F1F2}\u{1F1FD}',peru:'\u{1F1F5}\u{1F1EA}',colombia:'\u{1F1E8}\u{1F1F4}',brazil:'\u{1F1E7}\u{1F1F7}',argentina:'\u{1F1E6}\u{1F1F7}',morocco:'\u{1F1F2}\u{1F1E6}',kenya:'\u{1F1F0}\u{1F1EA}','south africa':'\u{1F1FF}\u{1F1E6}',turkey:'\u{1F1F9}\u{1F1F7}',greece:'\u{1F1EC}\u{1F1F7}',croatia:'\u{1F1ED}\u{1F1F7}',iceland:'\u{1F1EE}\u{1F1F8}'};
var CSYMS={INR:'\u20B9',NPR:'Rs',LKR:'Rs',THB:'\u0E3F',MMK:'K',USD:'$',EUR:'\u20AC',GBP:'\u00A3',AUD:'A$',NZD:'NZ$',SGD:'S$',MYR:'RM',VND:'\u20AB',IDR:'Rp',PHP:'\u20B1',JPY:'\u00A5',CNY:'\u00A5',MXN:'$',BRL:'R$'};
var cfg={name:'',tripStart:'',budget:1000,homeCur:'AUD',theme:'light',lastLoc:'',customCats:[],profile:{country:'India',local:'INR',sym:'\u20B9',flag:'\u{1F1EE}\u{1F1F3}',rate:64.14}};
var exps=[],selId=null,confCatId=7,editCatId=7,lv='date';
function persist(){try{localStorage.setItem(SK,JSON.stringify({cfg:cfg,exps:exps}))}catch(e){}}
function hydrate(){try{var d=JSON.parse(localStorage.getItem(SK)||'{}');if(d.cfg)cfg=Object.assign({name:'',tripStart:today(),budget:1000,homeCur:'AUD',theme:'light',lastLoc:'',customCats:[]},d.cfg);if(d.exps)exps=d.exps}catch(e){}}
function applyTheme(){document.documentElement.setAttribute('data-theme',cfg.theme||'light');document.getElementById('ttog').textContent=cfg.theme==='dark'?'\u2600\uFE0F':'\u{1F319}';var el=document.getElementById('s-theme');if(el)el.textContent=cfg.theme==='dark'?'Dark':'Light'}
function toggleTheme(){cfg.theme=cfg.theme==='dark'?'light':'dark';applyTheme();persist()}
function today(){return new Date().toISOString().split('T')[0]}
function fL(n,sym){if(n==null)return'\u2014';return(sym||cfg.profile.sym)+Number(n).toLocaleString('en-IN',{maximumFractionDigits:0})}
function fH(n){if(n==null)return'\u2014';return cfg.homeCur+' '+Number(n).toLocaleString('en-AU',{minimumFractionDigits:2,maximumFractionDigits:2})}
function wkNum(d){if(!cfg.tripStart||!d)return 1;return Math.max(1,Math.floor((new Date(d)-new Date(cfg.tripStart))/(7*864e5))+1)}
function wkLabel(n){var s=new Date(cfg.tripStart);var ws=new Date(s.getTime()+(n-1)*7*864e5);var we=new Date(s.getTime()+n*7*864e5-864e5);function f(d){return d.toLocaleDateString('en-AU',{day:'numeric',month:'short'})}return f(ws)+' \u2013 '+f(we)}
function showToast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('on');setTimeout(function(){t.classList.remove('on')},2600)}
function allCats(){return CATS.concat(cfg.customCats||[])}
function catById(id){var c=allCats();for(var i=0;i<c.length;i++){if(c[i].id===id)return c[i]}return CATS[7]}
function catByName(n){var c=allCats();for(var i=0;i<c.length;i++){if(c[i].n===n)return c[i]}return CATS[7]}
function allDays(){var days=[],s=new Date(cfg.tripStart),e=new Date(today());for(var i=0;i<exps.length;i++){var expDate=new Date(exps[i].date);if(exps[i].days&&exps[i].days>1){var tail=new Date(expDate.getTime()+(exps[i].days-1)*864e5);if(tail>e)e=tail;}else if(expDate>e){e=expDate;}}var d=new Date(s.getTime());while(d<=e){days.push(d.toISOString().split('T')[0]);d.setDate(d.getDate()+1)}return days}
function symFor(l){return CSYMS[l]||l}
function flagFor(l){var m={INR:'\u{1F1EE}\u{1F1F3}',NPR:'\u{1F1F3}\u{1F1F5}',LKR:'\u{1F1F1}\u{1F1F0}',THB:'\u{1F1F9}\u{1F1ED}',USD:'\u{1F1FA}\u{1F1F8}',EUR:'\u{1F1EA}\u{1F1FA}',GBP:'\u{1F1EC}\u{1F1E7}',AUD:'\u{1F1E6}\u{1F1FA}',NZD:'\u{1F1F3}\u{1F1FF}'};return m[l]||'\u{1F30D}'}
function finishSetup(){var name=document.getElementById('ob-name').value.trim();var start=document.getElementById('ob-start').value||today();var budget=parseFloat(document.getElementById('ob-budget').value)||1000;var home=(document.getElementById('ob-home').value||'AUD').toUpperCase();var country=document.getElementById('ob-country').value.trim()||'India';var local=(document.getElementById('ob-local').value||'INR').toUpperCase();var rate=parseFloat(document.getElementById('ob-rate').value)||64.14;cfg={name:name,tripStart:start,budget:budget,homeCur:home,theme:'light',lastLoc:'',customCats:[],profile:{country:country,local:local,sym:symFor(local),flag:CFLAGS[country.toLowerCase()]||flagFor(local),rate:rate}};persist();launchApp()}
function launchApp(){document.getElementById('ob').classList.remove('on');document.getElementById('app').classList.add('on');document.getElementById('cc-date').value=today();document.getElementById('cc-hclbl').textContent=cfg.homeCur;document.getElementById('cc-sym').textContent=cfg.profile.sym;document.getElementById('e-hclbl').textContent=cfg.homeCur;applyTheme();updateHeader();updateSettings();renderAll();clearCC();goView('add')}
function updateHeader(){document.getElementById('hdr-pill').textContent=cfg.profile.flag+' '+cfg.profile.local}
function autoFlag(){var c=document.getElementById('p-country').value.trim().toLowerCase();var f=CFLAGS[c];if(f)document.getElementById('p-flag').value=f}
function autoSym(){var l=(document.getElementById('p-local').value||'').toUpperCase();var s=symFor(l);if(s!==l)document.getElementById('p-sym').value=s}
function parseIt(){var raw=document.getElementById('qinput').value.trim();if(!raw)return;var re=/(\d+(?:\.\d+)?)(k)?/gi,m,nums=[];while((m=re.exec(raw))!==null)nums.push(m);var days=0;var dm=raw.match(/(\d+)\s*(?:nights?|days?)/i);if(dm)days=parseInt(dm[1]);var amtNums=nums.filter(function(n){return!(dm&&parseFloat(n[1])===days&&!n[2])});if(!amtNums.length)amtNums=nums;var amt=0;if(amtNums.length){var best=amtNums.reduce(function(a,b){return parseFloat(a[1])*(a[2]?1000:1)>=parseFloat(b[1])*(b[2]?1000:1)?a:b});amt=parseFloat(best[1])*(best[2]?1000:1)}var isNight=/nights?/i.test(raw);var desc=raw.replace(/\d+\s*(?:nights?|days?)/gi,'').replace(/\d+(?:\.\d+)?k?/gi,'').replace(/\s+/g,' ').trim();var dl=desc.toLowerCase();var bestId=0,bestScore=0;var ac=allCats();for(var i=0;i<ac.length;i++){var score=0;for(var j=0;j<(ac[i].kw||[]).length;j++){var kw=ac[i].kw[j];var kwMatch=kw.indexOf(' ')>=0?dl.indexOf(kw)>=0:new RegExp('\\b'+kw+'\\b').test(dl);if(kwMatch)score+=kw.length>5?2:1}if(score>bestScore){bestScore=score;bestId=ac[i].id}}if(/\b(hotel|hostel|lodge|resort|guesthouse|airbnb|inn|camp|accom|retreat|villa|apartment|apt|bnb|bungalow|riad|cottage|dorm)\b/i.test(dl))bestId=2;confCatId=bestId;document.getElementById('cc-inr').value=amt||'';document.getElementById('cc-date').value=today();document.getElementById('cc-note').value=desc;var ll=cfg.lastLoc||'';document.getElementById('cc-loc').value=ll;document.getElementById('cc-loc').style.color=ll?'var(--ink3)':'var(--ink)';document.getElementById('cc-loc').setAttribute('data-prefilled',ll?'1':'0');document.getElementById('cc-days').value=days||'';recalc();renderChips('cc-chips',confCatId,'pickCC');var showD=bestId===2||days>0;document.getElementById('cc-nrow').classList.toggle('on',showD);document.getElementById('splitbtn').style.display=showD?'none':'block';document.getElementById('cc-dlbl').textContent=(bestId===2||isNight)?'Nights':'Days';document.getElementById('cc').classList.add('on');document.getElementById('qinput').blur()}
function renderChips(elId,activeId,fn){var ac=allCats(),chips='';for(var i=0;i<ac.length;i++){chips+='<button class="chip'+(ac[i].id===activeId?' on':'')+'" onclick="pickCC('+ac[i].id+');showCCChips(false)">'+(ac[i].e||'\u2B50')+' '+ac[i].n+'</button>'}document.getElementById('cc-chips').innerHTML=chips;var active=allCats().find(function(c){return c.id===activeId})||allCats()[7];document.getElementById('cc-pick-wrap').innerHTML='<div class="cc-pick" onclick="showCCChips(true)">'+(active.e||'\u2B50')+' <strong>'+active.n+'</strong><span class="cc-pick-hint">not right?</span></div>'}
function showCCChips(show){document.getElementById('cc-chips-wrap').style.display=show?'block':'none'}
function pickCC(id){confCatId=id;renderChips('cc-chips',confCatId,'pickCC');var isA=id===2;document.getElementById('cc-nrow').classList.toggle('on',isA);document.getElementById('splitbtn').style.display=isA?'none':'block';document.getElementById('cc-dlbl').textContent=isA?'Nights':'Days'}
function pickEC(id){editCatId=id;renderChips('e-chips',editCatId,'pickEC');var show=id===2||(parseInt(document.getElementById('e-days').value)||0)>0;document.getElementById('e-nrow').style.display=show?'block':'none';document.getElementById('e-dlbl').textContent=id===2?'Nights':'Days'}
function showSplit(){document.getElementById('cc-nrow').classList.add('on');document.getElementById('splitbtn').style.display='none';document.getElementById('cc-dlbl').textContent=confCatId===2?'Nights':'Days';document.getElementById('cc-days').focus()}
function setYesterday(){var d=new Date();d.setDate(d.getDate()-1);document.getElementById('cc-date').value=d.toISOString().split('T')[0];}
function recalc(){var inr=parseFloat(document.getElementById('cc-inr').value)||0;var days=parseFloat(document.getElementById('cc-days').value)||0;var aud=inr/cfg.profile.rate;document.getElementById('cc-aud').textContent=fH(aud);document.getElementById('cc-pn').textContent=(days>1&&inr>0)?fH(aud/days)+'/unit':'\u2014'}
function clearCC(){document.getElementById('cc').classList.remove('on');document.getElementById('qinput').value='';confCatId=7;document.getElementById('cc-nrow').classList.remove('on');document.getElementById('splitbtn').style.display='none'}
function saveExp(){var inr=parseFloat(document.getElementById('cc-inr').value);if(!inr||isNaN(inr)){showToast('Enter an amount first');return}var date=normaliseDate(document.getElementById('cc-date').value||today());var days=parseInt(document.getElementById('cc-days').value)||0;var note=document.getElementById('cc-note').value.trim();var loc=document.getElementById('cc-loc').value.trim();if(loc)cfg.lastLoc=loc;var cat=catById(confCatId);var isNt=document.getElementById('cc-dlbl').textContent==='Nights';exps.unshift({id:Date.now().toString(),date:date,catId:cat.id,catName:cat.n,loc:loc,inr:inr,aud:inr/cfg.profile.rate,days:days,isNight:isNt,note:note,country:cfg.profile.country,local:cfg.profile.local,sym:cfg.profile.sym,flag:cfg.profile.flag,rate:cfg.profile.rate});persist();renderAll();clearCC();if(days>1){var unitLbl=isNt?'night':'day';showToast('\u2713 '+fL(inr)+' spread across '+days+' '+unitLbl+'s \u00B7 '+fH((inr/cfg.profile.rate)/days)+'/'+unitLbl)}else{showToast('\u2713 '+cat.n+' \u00B7 '+fL(inr))}}
function openExp(id){var e=null;for(var i=0;i<exps.length;i++){if(exps[i].id===id){e=exps[i];break}}if(!e)return;selId=id;fillDetail(e);switchMode('detail');openModal('m-exp')}
function fillDetail(e){var c=catByName(e.catName);document.getElementById('me-title').textContent=c.e+' '+e.catName;var days=e.days||0;var ul=e.catId===2?'nights':'days';var pn=days>1?'<div style="font-size:.76rem;color:var(--ink2);margin-top:3px">'+days+' '+ul+' \u00B7 '+fH(e.aud/days)+'/'+ul.slice(0,-1)+'</div>':'';var loc=e.loc?'<div><div style="font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px">Location</div><div style="font-size:.84rem">'+e.loc+'</div></div>':'';document.getElementById('me-body').innerHTML='<div style="margin-bottom:14px"><div style="font-family:Georgia,serif;font-size:2rem;font-weight:700;letter-spacing:-.02em;line-height:1">'+fL(e.inr,e.sym)+'</div><div style="font-size:.92rem;color:var(--ok);font-weight:700;margin-top:2px">'+fH(e.aud)+'</div>'+pn+'</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px"><div><div style="font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px">Date</div><div style="font-size:.84rem">'+e.date+'</div></div><div><div style="font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px">Week</div><div style="font-size:.84rem">Week '+wkNum(e.date)+'</div></div><div><div style="font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px">Country</div><div style="font-size:.84rem">'+(e.flag||'')+' '+(e.country||'\u2014')+'</div></div><div><div style="font-size:.62rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px">Rate</div><div style="font-size:.84rem">1 '+cfg.homeCur+' = '+(e.sym||'')+(e.rate||'')+'</div></div>'+loc+'</div>'+(e.note?'<div style="background:var(--bg3);border-radius:8px;padding:10px 12px;font-size:.82rem;color:var(--ink2)">'+e.note+'</div>':'')}
function switchMode(mode){document.getElementById('me-detail').style.display=mode==='detail'?'block':'none';document.getElementById('me-edit').style.display=mode==='edit'?'block':'none';if(mode==='edit'){var e=null;for(var i=0;i<exps.length;i++){if(exps[i].id===selId){e=exps[i];break}}if(!e)return;editCatId=(e.catId!==undefined)?e.catId:catByName(e.catName).id;var days=e.days||0;document.getElementById('e-inr').value=e.inr;document.getElementById('e-date').value=e.date;document.getElementById('e-loc').value=e.loc||'';document.getElementById('e-days').value=days||'';document.getElementById('e-note').value=e.note||'';document.getElementById('e-nrow').style.display=(editCatId===2||days>0)?'block':'none';document.getElementById('e-dlbl').textContent=editCatId===2?'Nights':'Days';recalcEdit();renderChips('e-chips',editCatId,'pickEC')}}
function recalcEdit(){var inr=parseFloat(document.getElementById('e-inr').value)||0;document.getElementById('e-aud').textContent=fH(inr/cfg.profile.rate)}
function saveEdit(){var inr=parseFloat(document.getElementById('e-inr').value);if(!inr||isNaN(inr)){showToast('Enter an amount');return}var idx=-1;for(var i=0;i<exps.length;i++){if(exps[i].id===selId){idx=i;break}}if(idx===-1)return;var orig=exps[idx],cat=catById(editCatId);var days=parseInt(document.getElementById('e-days').value)||0;exps[idx]={id:orig.id,date:normaliseDate(document.getElementById('e-date').value||orig.date),catId:cat.id,catName:cat.n,loc:document.getElementById('e-loc').value.trim(),inr:inr,aud:inr/orig.rate,days:days,note:document.getElementById('e-note').value.trim(),country:orig.country,local:orig.local,sym:orig.sym,flag:orig.flag,rate:orig.rate};persist();renderAll();fillDetail(exps[idx]);switchMode('detail');showToast('Updated \u2713')}
function doDelete(){if(!confirm('Remove this expense?'))return;var n=[];for(var i=0;i<exps.length;i++){if(exps[i].id!==selId)n.push(exps[i])}exps=n;persist();renderAll();closeModal('m-exp');showToast('Removed')}
function tapDay(d,amt){var notes=[];for(var i=0;i<exps.length;i++){var e=exps[i];if(e.days&&e.days>1&&dailyAud(e,d)>0){var dn=Math.round((new Date(d)-new Date(e.date))/864e5)+1;var lbl=(e.note||e.catName).split(' ')[0].toLowerCase().slice(0,6);notes.push(lbl+' '+dn+'/'+e.days);}}showToast(fH(amt)+(notes.length?' ¬∑ '+notes.join(' ¬∑ '):''));}
function renderAll(){renderBudget();renderStats();renderRecent();renderLog();renderReports();updateSettings()}
function dailyAud(e,d){var days=e.days&&e.days>1?e.days:0;if(!days)return e.date===d?e.aud:0;var share=e.aud/days;var start=new Date(e.date);for(var n=0;n<days;n++){var dd=new Date(start.getTime()+n*864e5).toISOString().split('T')[0];if(dd===d)return share;}return 0}
function dailyAudForWeek(e,wn){var days=e.days&&e.days>1?e.days:0;if(!days)return wkNum(e.date)===wn?e.aud:0;var share=e.aud/days,total=0;var start=new Date(e.date);for(var n=0;n<days;n++){var dd=new Date(start.getTime()+n*864e5).toISOString().split('T')[0];if(wkNum(dd)===wn)total+=share;}return total}
function attributedToDate(d){var total=0;for(var i=0;i<exps.length;i++){var e=exps[i];if(!e.days||e.days<=1){if(e.date<=d)total+=e.aud;}else{var share=e.aud/e.days;var start=new Date(e.date);for(var n=0;n<e.days;n++){var dd=new Date(start.getTime()+n*864e5).toISOString().split('T')[0];if(dd<=d)total+=share;}}}return total}
function renderBudget(){var wn=wkNum(today()),spent=0;for(var i=0;i<exps.length;i++){spent+=dailyAudForWeek(exps[i],wn)}var pct=Math.min(spent/cfg.budget*100,100),rem=cfg.budget-spent;var cls=pct>90?'over':pct>70?'warn':'ok';document.getElementById('budget-card').innerHTML='<div class="bwk">Week '+wn+' \u00B7 '+wkLabel(wn)+'</div><div class="brow"><div><div class="bamt">'+fH(spent)+'</div><div class="bof">of '+fH(cfg.budget)+' this week</div></div><div class="bpill bp-'+cls+'">'+(rem>=0?fH(rem)+' left':fH(-rem)+' over')+'</div></div><div class="bbar"><div class="bfill bf-'+cls+'" style="width:'+pct+'%"></div></div>'}
function renderStats(){var t=today(),tod=0,tot=0;for(var i=0;i<exps.length;i++){tot+=exps[i].aud;tod+=dailyAud(exps[i],t)}var days=Math.max(1,Math.round((new Date(t)-new Date(cfg.tripStart))/864e5)+1);var dailyBudget=cfg.budget/7;var attributed=attributedToDate(t);var dailyAvg=attributed/days;document.getElementById('stats-row').innerHTML='<div class="stat"><div class="sv">'+fH(tod)+'</div><div class="sl">today</div></div>'+'<div class="stat"><div class="sv">'+fH(dailyAvg)+'</div><div class="sl-pair"><span class="sl">avg/day</span><span class="sl-budget">of '+fH(dailyBudget)+'</span></div></div>'+'<div class="stat"><div class="sv">'+fH(tot)+'</div><div class="sl">Day '+days+'</div></div>'}
function eHTML(e){var c=catByName(e.catName);var loc=e.loc?' \u00B7 '+e.loc:'';var days=e.days||0;var unitLbl=e.isNight?'night':(e.catId===2?'night':'day');var pn=days>1?'<div class="epn">'+days+' '+unitLbl+(days!==1?'s':'')+' \u00B7 '+fH(e.aud/days)+'/'+unitLbl+'</div>':'';return'<div class="erow" onclick="openExp(\''+e.id+'\')"><div class="eico">'+c.e+'</div><div><div class="ecat">'+(e.note||c.n)+'</div><div class="emeta">'+e.date+loc+'</div></div><div class="eamts"><div class="einr">'+fL(e.inr,e.sym)+'</div><div class="eaud">'+fH(e.aud)+'</div>'+pn+'</div></div>'}
function renderRecent(){var el=document.getElementById('recent');if(!exps.length){el.innerHTML='<div class="empty"><div class="empty-ico">\u{1F33F}</div><p>Your purse is empty. Add your first expense above.</p></div>';return}var h='';for(var i=0;i<Math.min(exps.length,5);i++)h+=eHTML(exps[i]);if(exps.length>5)h+='<div class="slink-row"><button class="slink" onclick="goView(\u0022log\u0022)">See all '+exps.length+' expenses ‚Üí</button></div>';el.innerHTML=h}
function renderExportNudge(){var n=document.getElementById('export-nudge');if(!n)return;if(exps.length>=10){var dismissed=localStorage.getItem('sb-nudge-dismissed');var dKey='sb-nudge-week-'+Math.floor(Date.now()/(7*864e5*1000));if(!dismissed||dismissed!==dKey){n.style.display='flex';n.setAttribute('data-key',dKey);}else{n.style.display='none';}}else{n.style.display='none';}}
function dismissNudge(){var n=document.getElementById('export-nudge');if(n){localStorage.setItem('sb-nudge-dismissed',n.getAttribute('data-key'));n.style.display='none';}}
function renderLog(){var qEl=document.getElementById('lsearch'),q=qEl?qEl.value.toLowerCase():'';var aEl=document.querySelector('.fchip.on'),af=aEl?aEl.getAttribute('data-f'):'all';var filtered=[];for(var i=0;i<exps.length;i++){var e=exps[i],ms=!q||e.catName.toLowerCase().indexOf(q)>=0||(e.note||'').toLowerCase().indexOf(q)>=0||(e.loc||'').toLowerCase().indexOf(q)>=0||(e.country||'').toLowerCase().indexOf(q)>=0;if(ms&&(af==='all'||e.catName===af))filtered.push(e)}var cats=[];for(var i=0;i<exps.length;i++){if(cats.indexOf(exps[i].catName)<0)cats.push(exps[i].catName)}var chips='<div class="fchip on" data-f="all" onclick="setFilter(this,\'all\')">All ('+exps.length+')</div>';for(var i=0;i<cats.length;i++){var c=catByName(cats[i]),n=0;for(var j=0;j<exps.length;j++){if(exps[j].catName===cats[i])n++}chips+='<div class="fchip" data-f="'+cats[i]+'" onclick="setFilter(this,\''+cats[i]+'\')">'+c.e+' '+cats[i]+' ('+n+')</div>'}document.getElementById('frow2').innerHTML=chips;if(!filtered.length){document.getElementById('logfeed').innerHTML='<div class="empty"><div class="empty-ico">\u{1F50D}</div><p>Nothing found.</p></div>';return}var html='';if(lv==='date'){var byDate={},dateOrder=[];for(var i=0;i<filtered.length;i++){var d=filtered[i].date;if(!byDate[d]){byDate[d]=[];dateOrder.push(d)}byDate[d].push(filtered[i])}dateOrder.sort(function(a,b){return b.localeCompare(a)});for(var i=0;i<dateOrder.length;i++){var d=dateOrder[i],ents=byDate[d],dt=0;for(var j=0;j<ents.length;j++)dt+=ents[j].aud;var dl=new Date(d).toLocaleDateString('en-AU',{weekday:'short',day:'numeric',month:'short'});html+='<div class="datehdr"><span class="dh-d">'+dl+'</span><span class="dh-a">'+fH(dt)+'</span></div>';for(var j=0;j<ents.length;j++)html+=eHTML(ents[j])}}else{var lastC=null,coTot=0,coExps=[];for(var i=0;i<filtered.length;i++){var e=filtered[i],co=e.country||'';if(co!==lastC){if(lastC!==null){html+='<div class="legdiv"><span>'+(coExps[0].flag||'\u{1F30D}')+' '+lastC+'</span><span style="font-size:.7rem;color:var(--ink2);font-weight:700">'+fH(coTot)+'</span></div>';for(var k=0;k<coExps.length;k++)html+=eHTML(coExps[k]);}lastC=co;coTot=0;coExps=[];}coTot+=e.aud;coExps.push(e);}if(lastC!==null){html+='<div class="legdiv"><span>'+(coExps[0].flag||'\u{1F30D}')+' '+lastC+'</span><span style="font-size:.7rem;color:var(--ink2);font-weight:700">'+fH(coTot)+'</span></div>';for(var k=0;k<coExps.length;k++)html+=eHTML(coExps[k]);}}document.getElementById('logfeed').innerHTML=html}
function setFilter(el,f){var chips=document.querySelectorAll('.fchip');for(var i=0;i<chips.length;i++)chips[i].classList.remove('on');el.classList.add('on');renderLog()}
function setLV(v){lv=v;document.getElementById('vtb-date').classList.toggle('on',v==='date');document.getElementById('vtb-country').classList.toggle('on',v==='country');renderLog()}
function renderReports(){renderDaily();renderWeekly();renderCountry();renderCat();renderLoc()}
function renderDaily(){var days=allDays();if(!days.length){document.getElementById('dchart').innerHTML='';return}var totals={};for(var i=0;i<days.length;i++)totals[days[i]]=0;for(var i=0;i<exps.length;i++){var _days=Object.keys(totals);for(var _j=0;_j<_days.length;_j++){var _share=dailyAud(exps[i],_days[_j]);if(_share)totals[_days[_j]]+=_share;}}var db=cfg.budget/7,vals=[db*1.3];for(var k in totals)vals.push(totals[k]);var maxV=Math.max.apply(null,vals)||1;var t=today(),H=66,bars='';for(var i=0;i<days.length;i++){var d=days[i],amt=totals[d]||0,hp=Math.round(amt/maxV*H);var isT=d===t,cls=amt===0?'zero':amt>db*1.2?'over':amt>db*0.8?'warn':'ok';var parts=new Date(d).toLocaleDateString('en-AU',{day:'numeric',month:'short'}).split(' ');bars+='<div class="dbc'+(isT?' tod':'')+'" onclick="tapDay(\''+d+'\','+amt+')"><div class="dbb '+cls+'" style="height:'+Math.max(hp,2)+'px"></div><div class="dbl">'+parts[0]+'<br>'+(parts[1]||'')+'</div></div>'}document.getElementById('dchart').innerHTML=bars;var tot=0;for(var i=0;i<exps.length;i++)tot+=exps[i].aud;var spreadAvg=attributedToDate(today())/Math.max(days.length,1);document.getElementById('dcsub').textContent='Daily budget: '+fH(db)+'  \u00B7  Actual avg: '+fH(spreadAvg);setTimeout(function(){var c=document.getElementById('dchart');if(c){var idx=days.indexOf(today());if(idx>=0)c.parentElement.scrollLeft=Math.max(0,(idx-4)*33)}},80)}
function renderWeekly(){if(!exps.length){document.getElementById('r-weekly').innerHTML='<div style="padding:10px 0;font-size:.78rem;color:var(--ink3)">No expenses yet.</div>';return}var wks={};for(var i=0;i<exps.length;i++){var _wks2=Object.keys(wks).length?Object.keys(wks):[wkNum(exps[i].date)];var _days2=exps[i].days&&exps[i].days>1?exps[i].days:0;if(!_days2){var w=wkNum(exps[i].date);wks[w]=(wks[w]||0)+exps[i].aud;}else{var _share2=exps[i].aud/exps[i].days;var _start2=new Date(exps[i].date);for(var _n2=0;_n2<exps[i].days;_n2++){var _dd2=new Date(_start2.getTime()+_n2*864e5).toISOString().split('T')[0];var _w2=wkNum(_dd2);wks[_w2]=(wks[_w2]||0)+_share2;}}}var sorted=Object.keys(wks).sort(function(a,b){return+a-+b}),vals=[];for(var i=0;i<sorted.length;i++)vals.push(wks[sorted[i]]);var max=Math.max.apply(null,vals)||1,html='';for(var i=0;i<sorted.length;i++){var w=sorted[i],aud=wks[w],pct=(aud/max*100).toFixed(0),vs=aud-cfg.budget;html+='<div class="wrow"><div><div class="wlbl">Week '+w+'</div><div class="wdates">'+wkLabel(+w)+'</div></div><div><div class="wbar"><div class="wbf" style="width:'+pct+'%"></div></div></div><div class="wamt">'+fH(aud)+'</div><div class="wvs '+(vs>0?'wover':'wok')+'">'+(vs>0?'+':'')+fH(vs)+'</div></div>'}document.getElementById('r-weekly').innerHTML=html}
function renderCountry(){var tots={},flags={},counts={};for(var i=0;i<exps.length;i++){var c=exps[i].country||'Unknown';tots[c]=(tots[c]||0)+exps[i].aud;flags[c]=exps[i].flag||'\u{1F30D}';counts[c]=(counts[c]||0)+1}var keys=Object.keys(tots).sort(function(a,b){return tots[b]-tots[a]});if(!keys.length){document.getElementById('r-country').innerHTML='<div style="padding:10px 0;font-size:.78rem;color:var(--ink3)">No data yet.</div>';return}var max=tots[keys[0]],total=0,html='';for(var i=0;i<keys.length;i++)total+=tots[keys[i]];for(var i=0;i<keys.length;i++){var co=keys[i],aud=tots[co],pct=(aud/max*100).toFixed(0),share=(aud/total*100).toFixed(0),n=counts[co];html+='<div class="crow"><div class="cflag">'+flags[co]+'</div><div><div class="cname">'+co+'</div><div class="rbar" style="margin-top:5px"><div class="rfill" style="width:'+pct+'%;background:var(--pri)"></div></div><div class="csub">'+n+' expense'+(n!==1?'s':'')+' \u00B7 '+share+'% of trip</div></div><div class="ramt">'+fH(aud)+'</div></div>'}document.getElementById('r-country').innerHTML=html}
function renderCat(){var tots={};for(var i=0;i<exps.length;i++)tots[exps[i].catName]=(tots[exps[i].catName]||0)+exps[i].aud;var keys=Object.keys(tots).sort(function(a,b){return tots[b]-tots[a]});if(!keys.length){document.getElementById('r-cat').innerHTML='';return}var max=tots[keys[0]],tripTot=0;for(var i=0;i<exps.length;i++)tripTot+=exps[i].aud;var rows='';for(var i=0;i<keys.length;i++){var cat=keys[i],aud=tots[cat],c=catByName(cat),n=0;for(var j=0;j<exps.length;j++){if(exps[j].catName===cat)n++}var pct=Math.round(aud/max*100),share=Math.round(aud/tripTot*100);rows+='<div class="rrow"><div class="rico">'+(c.e||'‚≠ê')+'</div><div><div class="rname">'+cat+'</div><div class="rbar"><div class="rfill" style="width:'+pct+'%;background:'+RC[i%RC.length]+'"></div></div><div class="rsub">'+n+' expense'+(n!==1?'s':'')+' ¬∑ '+share+'% of trip</div></div><div class="ramt">'+fH(aud)+'</div></div>'}document.getElementById('r-cat').innerHTML=rows}
function renderLoc(){var wl=[];for(var i=0;i<exps.length;i++){if(exps[i].loc)wl.push(exps[i])}if(!wl.length){document.getElementById('r-loc').innerHTML='<div style="padding:12px 0"><div style="font-size:.82rem;font-weight:600;color:var(--ink2);margin-bottom:4px">No trail yet.</div><div style="font-size:.76rem;color:var(--ink3);line-height:1.6">Add a location when logging an expense and it will appear here.</div></div>';return}var tots={};for(var i=0;i<wl.length;i++)tots[wl[i].loc]=(tots[wl[i].loc]||0)+wl[i].aud;var keys=Object.keys(tots).sort(function(a,b){return tots[b]-tots[a]});var max=tots[keys[0]],html='';for(var i=0;i<keys.length;i++){var loc=keys[i],aud=tots[loc],n=0;for(var j=0;j<wl.length;j++){if(wl[j].loc===loc)n++}var pct=(aud/max*100).toFixed(0);html+='<div class="rrow"><div class="rico">\u{1F4CD}</div><div><div class="rname">'+loc+'</div><div class="rbar"><div class="rfill" style="width:'+pct+'%;background:var(--acc)"></div></div><div class="rsub">'+n+' expense'+(n!==1?'s':'')+'</div></div><div class="ramt">'+fH(aud)+'</div></div>'}document.getElementById('r-loc').innerHTML=html}
function updateSettings(){var p=cfg.profile;document.getElementById('s-country').textContent=p.flag+' '+p.country+' \u00B7 '+p.local;document.getElementById('s-rate').textContent='1 '+cfg.homeCur+' = '+p.sym+p.rate+(p.rateUpdated?' ¬∑ '+p.rateUpdated:'');document.getElementById('s-budget').textContent=fH(cfg.budget)+'/wk';document.getElementById('s-start').textContent=cfg.tripStart;document.getElementById('s-name').textContent=cfg.name||'\u2014';var cc=cfg.customCats||[];document.getElementById('s-cc').textContent=cc.length?cc.map(function(c){return c.e+' '+c.n}).join(', '):'None';applyTheme()}
function openModal(id){document.getElementById(id).classList.add('on')}
function closeModal(id){document.getElementById(id).classList.remove('on')}
var _ovls=document.querySelectorAll('.ovl');for(var _i=0;_i<_ovls.length;_i++){_ovls[_i].addEventListener('click',(function(o){return function(e){if(e.target===o)o.classList.remove('on')}}(_ovls[_i])))}
function openProfileModal(){var p=cfg.profile;document.getElementById('p-country').value=p.country;document.getElementById('p-local').value=p.local;document.getElementById('p-sym').value=p.sym;document.getElementById('p-flag').value=p.flag;document.getElementById('p-rate').value=p.rate;document.getElementById('p-hclbl').textContent=cfg.homeCur;openModal('m-profile')}
function saveProfile(){var local=(document.getElementById('p-local').value.trim()||'INR').toUpperCase();var country=document.getElementById('p-country').value.trim()||'India';var flag=document.getElementById('p-flag').value.trim()||CFLAGS[country.toLowerCase()]||flagFor(local);cfg.profile={country:country,local:local,sym:document.getElementById('p-sym').value.trim()||symFor(local),flag:flag,rate:parseFloat(document.getElementById('p-rate').value)||cfg.profile.rate,rateUpdated:today()};document.getElementById('cc-sym').textContent=cfg.profile.sym;persist();updateHeader();updateSettings();closeModal('m-profile');showToast('Now in '+cfg.profile.flag+' '+cfg.profile.country);renderAll()}
function openRateModal(){document.getElementById('rate-sub').textContent='Current: 1 '+cfg.homeCur+' = '+cfg.profile.sym+cfg.profile.rate;document.getElementById('r-rate').value=cfg.profile.rate;openModal('m-rate')}
function saveRate(){var r=parseFloat(document.getElementById('r-rate').value);if(!r||r<=0)return;cfg.profile.rate=r;cfg.profile.rateUpdated=today();persist();updateSettings();closeModal('m-rate');showToast('Rate: 1 '+cfg.homeCur+' = '+cfg.profile.sym+r);renderAll()}
function openBudgetModal(){document.getElementById('b-val').value=cfg.budget;document.getElementById('b-hclbl').textContent=cfg.homeCur;openModal('m-budget')}
function saveBudget(){var b=parseFloat(document.getElementById('b-val').value);if(!b||b<=0)return;cfg.budget=b;persist();renderAll();updateSettings();closeModal('m-budget');showToast('Budget: '+fH(b)+'/week')}
function openStartModal(){document.getElementById('ts-date').value=cfg.tripStart;openModal('m-start')}
function saveStart(){var d=document.getElementById('ts-date').value;if(!d)return;cfg.tripStart=d;persist();renderAll();updateSettings();closeModal('m-start');showToast('Trip start updated')}
function openShareModal(){openModal('m-share')}
function openCustomCatModal(){renderCCList();openModal('m-customcat')}
function renderCCList(){var cc=cfg.customCats||[],html='';if(!cc.length)html='<div style="font-size:.78rem;color:var(--ink3);padding:8px 0">No custom categories yet.</div>';else for(var i=0;i<cc.length;i++)html+='<div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--bord)"><span>'+cc[i].e+' '+cc[i].n+'</span><button onclick="delCC('+cc[i].id+')" style="background:none;border:none;color:var(--err);cursor:pointer;padding:4px 8px;font-size:.8rem">Remove</button></div>';document.getElementById('ccat-list').innerHTML=html}
function addCustomCat(){var name=document.getElementById('ccat-n').value.trim();var emoji=document.getElementById('ccat-e').value.trim()||'\u2B50';if(!name){showToast('Enter a name');return}if(!cfg.customCats)cfg.customCats=[];cfg.customCats.push({id:200+cfg.customCats.length,n:name,e:emoji,kw:[name.toLowerCase()]});document.getElementById('ccat-n').value='';document.getElementById('ccat-e').value='';persist();renderCCList();updateSettings();showToast('Added: '+emoji+' '+name)}
function delCC(id){cfg.customCats=(cfg.customCats||[]).filter(function(c){return c.id!==id});persist();renderCCList();updateSettings();renderAll()}
function doExport(){if(!exps.length){showToast('Nothing to export yet');return}var cols=['Date','Week','Country','Category','Location',cfg.profile.local+' Amount',cfg.homeCur+' Amount','Per-Unit','Days','Note','Rate','Currency','Symbol','Flag'];var rows=[cols];for(var i=0;i<exps.length;i++){var e=exps[i],days=e.days||0;rows.push([e.date,'Week '+wkNum(e.date),e.country||'',e.catName,e.loc||'',e.inr,e.aud.toFixed(4),days>1?(e.aud/days).toFixed(4):'',days,e.note||'',e.rate||cfg.profile.rate,e.local||cfg.profile.local,e.sym||cfg.profile.sym,e.flag||''])}var csv='\uFEFF';for(var i=0;i<rows.length;i++){var parts=[];for(var j=0;j<rows[i].length;j++)parts.push('"'+String(rows[i][j]).replace(/"/g,'""')+'"');csv+=parts.join(',')+'\r\n'}var blob=new Blob([csv],{type:'text/csv;charset=utf-8'});var filename='second-breakfast-'+today()+'.csv';if(navigator.share&&navigator.canShare&&navigator.canShare({files:[new File([blob],filename,{type:'text/csv'})]})){var file=new File([blob],filename,{type:'text/csv'});navigator.share({files:[file],title:'Second Breakfast Backup',text:'Your expense backup \u2014 '+today()}).catch(function(){});return;}var a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);setTimeout(function(){URL.revokeObjectURL(a.href)},5000);showToast('Saved! Open in Excel or Google Sheets.')}
function doJsonBackup(){if(!exps.length){showToast('Nothing to back up yet');return}var data=JSON.stringify({cfg:cfg,exps:exps});if(navigator.share&&navigator.canShare){navigator.share({text:data,title:'Second Breakfast Backup'}).catch(function(){});return;}document.getElementById('bk-text').value=data;openModal('m-backup');showToast('Copy this code somewhere safe')}
function doJsonRestore(){var raw=document.getElementById('bk-text').value.trim();if(!raw){showToast('Paste your backup code first');return}try{var d=JSON.parse(raw);if(d.cfg)cfg=Object.assign({name:'',tripStart:today(),budget:1000,homeCur:'AUD',theme:'light',lastLoc:'',customCats:[]},d.cfg);if(d.exps&&d.exps.length){exps=d.exps;exps.sort(function(a,b){return b.date.localeCompare(a.date)});}persist();renderAll();closeModal('m-backup');showToast('Restored '+exps.length+' expenses')}catch(e){showToast('Invalid backup code')}}
function doImport(){document.getElementById('csv-input').click()}
function handleImport(ev){var file=ev.target.files[0];if(!file)return;var r=new FileReader();r.onload=function(e){try{var text=e.target.result.replace(/^\uFEFF/,'');var lines=text.trim().split(/\r?\n/).slice(1);var count=0;for(var i=0;i<lines.length;i++){var line=lines[i],cols=[],cur='',inQ=false;for(var k=0;k<=line.length;k++){var ch=line[k];if(inQ&&ch==='"'&&line[k+1]==='"'){cur+='"';k++}else if(ch==='"'){inQ=!inQ}else if((ch===','||k===line.length)&&!inQ){cols.push(cur);cur=''}else{cur+=(ch||'')}}var date=normaliseDate(cols[0]),country=cols[2]||'',catName=cols[3]||'Other',loc=cols[4]||'';var inr=cols[5]===''?0:parseFloat(cols[5]);if(isNaN(inr))inr=0;var aud=parseFloat(cols[6])||0,days=parseInt(cols[8])||0,note=cols[9]||'',rate=parseFloat(cols[10])||cfg.profile.rate,local=cols[11]||cfg.profile.local,sym=cols[12]||cfg.profile.sym,flag=cols[13]||'\u{1F30D}';if(!date)continue;var dup=false;for(var j=0;j<exps.length;j++){if(exps[j].date===date&&exps[j].catName===catName&&Math.abs(exps[j].inr-inr)<0.01){dup=true;break}}if(dup)continue;exps.push({id:date+catName+inr+Math.random(),date:date,catId:catByName(catName).id,catName:catName,country:country,flag:flag,loc:loc,inr:inr,aud:aud,days:days,note:note,rate:rate,local:local,sym:sym});count++}exps.sort(function(a,b){return b.date.localeCompare(a.date)});persist();renderAll();showToast('Restored '+count+' expense'+(count!==1?'s':''))}catch(err){showToast('Import failed')}};r.readAsText(file);ev.target.value=''}
function closeAllModals(){var ovls=document.querySelectorAll('.ovl');for(var i=0;i<ovls.length;i++)ovls[i].classList.remove('on')}
function clearExpenses(){if(!confirm('Remove all expenses? Your profile and settings are kept.'))return;exps=[];persist();closeAllModals();renderAll();goView('add');showToast('All expenses cleared')}
function newTrip(){if(!confirm('Start a new trip? This clears everything and returns to setup.'))return;exps=[];cfg={name:'',tripStart:'',budget:1000,homeCur:'AUD',theme:cfg.theme,lastLoc:'',customCats:[],profile:{country:'India',local:'INR',sym:'\u20B9',flag:'\u{1F1EE}\u{1F1F3}',rate:64.14}};persist();closeAllModals();clearCC();document.getElementById('app').classList.remove('on');var fields={'ob-name':'','ob-start':today(),'ob-budget':'1000','ob-home':'AUD','ob-country':'India','ob-local':'INR','ob-rate':'64.14'};Object.keys(fields).forEach(function(id){var el=document.getElementById(id);if(el)el.value=fields[id]});document.getElementById('ob').classList.add('on');showToast('Ready for a new adventure')}
function goView(name){var views=document.querySelectorAll('.view'),nbs=document.querySelectorAll('.nb');for(var i=0;i<views.length;i++)views[i].classList.remove('on');for(var i=0;i<nbs.length;i++)nbs[i].classList.remove('on');document.getElementById('v-'+name).classList.add('on');document.getElementById('nb-'+name).classList.add('on');if(name==='log'){renderLog();renderExportNudge();}if(name==='reports')renderReports();window.scrollTo({top:0,behavior:'smooth'})}
function setYesterday(){var y=new Date();y.setDate(y.getDate()-1);document.getElementById('cc-date').value=y.toISOString().split('T')[0];}
function normaliseDate(d){if(!d)return today();var s=String(d).trim();if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;var parts=s.split(/[\/\-\.\s]+/);if(parts.length>=3){var a=parts[0],b=parts[1],c=parts[2];if(a.length===4)return a+'-'+b.padStart(2,'0')+'-'+c.padStart(2,'0');if(c.length===4)return c+'-'+b.padStart(2,'0')+'-'+a.padStart(2,'0');}var dt=new Date(s);if(!isNaN(dt.getTime()))return dt.toISOString().split('T')[0];return today()}
function init(){hydrate();var ts=document.getElementById('ob-start');if(ts)ts.value=today();if(cfg.name||exps.length)launchApp()}
init();
</script>
</body>
</html>